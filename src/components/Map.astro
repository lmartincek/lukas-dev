---
import { locations } from "../constants/locations.ts";
---
<!-- TODO- reconsider rewriting to react component -->

<div id="map-overlay" style="display: none"
     class="fixed z-[1000] flex justify-center items-center inset-0 bg-black/50 backdrop-blur-sm sm:top-10 sm:right-10 sm:inset-auto sm:bg-transparent sm:backdrop-blur-0">
    <div class="maps-content-overlay bg-white w-[320px] md:w-[360px] max-h-[400px] p-5 rounded-lg text-left overflow-y-auto relative shadow-2xl">
        <div id="close-overlay" class="absolute top-4 right-4 cursor-pointer z-10">X</div>
        <div id="map-content" class="maps-content"/>
    </div>
</div>

<section class="pt-8">
    <h2 class="font-medium tracking-tight text-title">Map</h2>
    <div class="pt-1.5">
        <div id="map" class="h-96 w-full"></div>
    </div>
</section>

<script type="module" define:vars={{locations}}>
function getContent(title, year, photos) {
    return `
    <h3 class="text-primary text-xl">${title}</h3>
    <h4 class="text-sm font-bold my-2">${year}</h4>
    
    <p class="text-sm mb-5">Story to be told soon...</p>
    
    <h3 class="font-serif text-[1.25rem] tracking-widest mb-2">MEMORIES</h3>
    
    ${photos.map(({ img, alt, label }) => `
        <figure class="overflow-hidden shadow-md mb-5">
            <img 
                src="${img}" 
                alt="${alt}"
                class="w-full object-cover" 
                loading="lazy"
            />
            <figcaption class="text-center text-sm py-2">
                ${label}
            </figcaption>
        </figure>
    `).join('')}
`
}
async function initMap() {
    // Request needed libraries.
    const { Map } = await google.maps.importLibrary("maps");
    const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");

    const map = new Map(document.getElementById("map"), {
        zoom: 2,
        center: { lat: 35, lng: 5 },
        mapId: 'map',
        fullscreenControl: false,
        streetViewControl: false,
        mapTypeControl: false,
    });

    const closeBtn = document.getElementById('close-overlay')
    const mapOverlay = document.getElementById('map-overlay')
    const mapContent = document.getElementById('map-content')

    if (closeBtn && mapOverlay && mapContent) {
        closeBtn.addEventListener('click', () => {
            mapContent.innerHTML = "";
            mapOverlay.style.display = "none"
        })

        // Create the markers.
        locations.forEach(({ title, year, position, photos }) => {
            const beachFlagImg = document.createElement('img');
            beachFlagImg.src = 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png';
            beachFlagImg.ariaLabel = `marker-${title}`

            const marker = new AdvancedMarkerElement({
                position,
                map,
                content: beachFlagImg,
            });

            // Add a click listener for each marker, and set up the info window.
            marker.addListener('click', () => {
                mapContent.innerHTML = getContent(title, year, photos)
                mapOverlay.style.display = "flex"
            });
        });
    }
}

initMap().then()
</script>